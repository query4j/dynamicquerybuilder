# Query4j Error Messages Reference

This document provides a comprehensive catalog of all error messages generated by the Query4j Dynamic Query Builder library. It serves as a troubleshooting guide for developers to quickly identify, understand, and resolve issues.

## Table of Contents

1. [Exception Hierarchy](#exception-hierarchy)
2. [Core Module Errors](#core-module-errors)
3. [Cache Module Errors](#cache-module-errors)
4. [Optimizer Module Errors](#optimizer-module-errors)
5. [Maintenance Guidelines](#maintenance-guidelines)

---

## Exception Hierarchy

Query4j uses a structured exception hierarchy for consistent error handling:

```
DynamicQueryException (base)
├── QueryBuildException (construction/validation errors)
├── QueryExecutionException (runtime/database errors)
└── OptimizationException (query optimization errors)
```

### Base Exception: DynamicQueryException

**Location:** `com.github.query4j.core.DynamicQueryException`  
**Type:** Unchecked (RuntimeException)  
**Purpose:** Root exception for all Query4j library errors

---

## Core Module Errors

### Field Validation Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Field name must not be null` | Field validation | Null field name passed to predicate | Check that field names are properly initialized before use |
| `Field name must not be empty` | Field validation | Empty or whitespace-only field name | Ensure field names contain valid characters |
| `Field name contains invalid characters: '{fieldName}'. Valid pattern is [A-Za-z0-9_\\.]+` | Field validation | Field name contains invalid characters | Use only alphanumeric characters, underscores, and dots in field names |
| `Aggregated field name must not be null` | HAVING clause validation | Null aggregated field name | Verify aggregated field names in HAVING clauses |
| `Aggregated field name must not be empty` | HAVING clause validation | Empty aggregated field name | Provide valid aggregated field names |
| `Aggregated field name contains invalid characters: '{fieldName}'. Must be either a valid field name [A-Za-z0-9_\\.]+, or an aggregation function like COUNT(field)` | HAVING clause validation | Invalid aggregated field name format | Use valid field names or aggregation functions (COUNT, SUM, AVG, etc.) |

**Example Valid Field Names:**
```java
// ✅ Valid field names
"username"
"user_id" 
"account.balance"
"COUNT(orders)"
"SUM(amount)"

// ❌ Invalid field names  
"user-name"  // contains hyphen
"user name"  // contains space
"1user"      // starts with number
```

### Parameter Validation Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Parameter name must not be null` | Parameter validation | Null parameter name | Ensure parameter names are initialized |
| `Parameter name must not be empty` | Parameter validation | Empty parameter name | Provide non-empty parameter names |
| `Parameter name contains invalid characters: '{paramName}'. Parameter names must start with a letter and contain only letters, numbers, and underscores` | Parameter validation | Invalid parameter name format | Parameter names must start with a letter, followed by letters, numbers, or underscores |

**Example Valid Parameter Names:**
```java
// ✅ Valid parameter names
"param1"
"user_id"
"maxValue"

// ❌ Invalid parameter names
"1param"    // starts with number
"param-1"   // contains hyphen
"param name" // contains space
```

### Operator Validation Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Operator must not be null` | Operator validation | Null operator passed to predicate | Check operator initialization |
| `Operator must not be empty` | Operator validation | Empty operator string | Provide valid SQL operator |
| `Invalid operator: '{operator}'. Allowed operators are: [=, !=, <>, <, <=, >, >=, LIKE, NOT LIKE, ILIKE, NOT ILIKE, IS, IS NOT, IN, NOT IN, BETWEEN, NOT BETWEEN, EXISTS, NOT EXISTS]` | Operator validation | Unsupported or malformed operator | Use only whitelisted SQL operators |

**Supported Operators:**
```java
// Comparison operators
"=", "!=", "<>", "<", "<=", ">", ">="

// Pattern matching
"LIKE", "NOT LIKE", "ILIKE", "NOT ILIKE"  

// Null checking
"IS", "IS NOT"

// Set operations
"IN", "NOT IN", "BETWEEN", "NOT BETWEEN"

// Existence checking
"EXISTS", "NOT EXISTS"
```

### Predicate Construction Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Values list must not be null` | IN predicate | Null values list passed to whereIn() | Initialize values list before passing to IN predicates |
| `Values list must not be empty` | IN predicate | Empty values list | Provide at least one value for IN predicates |
| `Pattern must not be null` | LIKE predicate | Null pattern in LIKE predicate | Ensure pattern strings are initialized |
| `Start and end parameter names must be different to avoid conflicts` | BETWEEN predicate | Duplicate parameter names | Use different parameter names for start and end values |

**Example Code Snippets:**
```java
// ❌ Will throw "Values list must not be null"
List<String> roles = null;
query.whereIn("role", roles);

// ✅ Correct usage
List<String> roles = Arrays.asList("admin", "user");
query.whereIn("role", roles);

// ❌ Will throw "Pattern must not be null" 
String pattern = null;
query.whereLike("name", pattern);

// ✅ Correct usage
query.whereLike("name", "John%");
```

### Logical Predicate Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Operator must not be null` | Logical predicate | Null logical operator | Provide valid logical operator (AND, OR, NOT) |
| `Children list must not be null` | Logical predicate | Null children list | Initialize child predicates list |
| `Children list must not be empty` | Logical predicate | No child predicates | Add at least one child predicate |
| `Child predicate at index {i} must not be null` | Logical predicate | Null child predicate | Ensure all child predicates are properly initialized |
| `Invalid logical operator: '{operator}'. Allowed operators are: AND, OR, NOT` | Logical predicate | Invalid logical operator | Use only AND, OR, or NOT operators |
| `NOT operator must have exactly one child predicate, but got {count}` | NOT predicate | Wrong number of children for NOT | NOT operators require exactly one child predicate |

### Configuration Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Core configuration must not be null` | Config validation | Missing core configuration | Provide valid CoreConfig instance |
| `Cache configuration must not be null` | Config validation | Missing cache configuration | Provide valid CacheConfig instance |
| `Core configuration validation failed: {details}` | Config validation | Invalid core config values | Check core configuration parameters |
| `Cache configuration validation failed: {details}` | Config validation | Invalid cache config values | Verify cache configuration settings |
| `All configuration priorities must be positive` | Config validation | Non-positive priority values | Set positive priority values |
| `maxPredicateDepth must be at least 1, got: {value}` | Core config | Invalid predicate depth limit | Set predicate depth to 1 or higher |
| `maxPredicateCount must be at least 1, got: {value}` | Core config | Invalid predicate count limit | Set predicate count to 1 or higher |
| `maxInPredicateSize must be at least 1, got: {value}` | Core config | Invalid IN predicate size limit | Set IN predicate size to 1 or higher |
| `defaultPageSize must be at least 1, got: {value}` | Core config | Invalid default page size | Set default page size to 1 or higher |

---

## Cache Module Errors

### Cache Configuration Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Cache region name must not be null or empty` | Cache creation | Invalid cache region name | Provide non-empty cache region name |
| `Max size must be positive, got: {value}` | Cache config | Invalid cache size | Set positive cache size value |
| `Default TTL must be positive, got: {value}` | Cache config | Invalid TTL value | Set positive TTL in seconds |
| `defaultTtlSeconds must not be negative, got: {value}` | Cache config | Negative TTL | Use non-negative TTL values |
| `maxSize must be positive, got: {value}` | Cache config | Non-positive max size | Set positive maximum size |
| `defaultRegion must not be null or empty` | Cache config | Invalid default region | Provide valid default region name |
| `maintenanceIntervalSeconds must not be negative, got: {value}` | Cache config | Negative maintenance interval | Use non-negative maintenance interval |
| `maxKeyLength must be positive, got: {value}` | Cache config | Invalid key length limit | Set positive maximum key length |
| `concurrencyLevel must be positive, got: {value}` | Cache config | Invalid concurrency level | Set positive concurrency level |
| `warmupSize must not be negative, got: {value}` | Cache config | Negative warmup size | Use non-negative warmup size |

### Cache Operation Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Cache key must not be null or empty` | Cache operations | Invalid cache key | Provide valid cache key |
| `TTL seconds must not be negative, got: {value}` | Cache put operation | Negative TTL | Use non-negative TTL values |
| `Cache get operation failed for key: {key}` | Cache retrieval | Cache access failure | Check cache health and connectivity |
| `Cache put operation failed for key: {key}` | Cache storage | Cache write failure | Verify cache capacity and configuration |
| `Cache invalidation failed for key: {key}` | Cache invalidation | Cache removal failure | Check cache status and retry if needed |
| `Cache clear operation failed` | Cache clearing | Cache reset failure | Verify cache manager status |
| `Cache containsKey operation failed for key: {key}` | Cache lookup | Cache check failure | Validate cache connectivity |
| `Cache maintenance operation failed` | Cache maintenance | Maintenance task failure | Check cache configuration and resources |

**Example Cache Usage:**
```java
// ✅ Correct cache configuration
CacheManager cache = CaffeineCacheManager.create(10000, 3600);

// ❌ Will throw "Max size must be positive"
CacheManager cache = CaffeineCacheManager.create(-1, 3600);

// ❌ Will throw "Cache key must not be null or empty"
cache.get(null);

// ✅ Correct cache operations
cache.put("user:123", userData, 1800);
```

---

## Optimizer Module Errors

### Configuration Loading Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Failed to load optimizer configuration` | Config loading | Configuration load failure | Check configuration file format and accessibility |
| `Configuration file not found: {path}` | Config loading | Missing config file | Verify configuration file path and permissions |
| `Unsupported configuration file format: {path}` | Config loading | Invalid file format | Use supported configuration formats (properties, JSON, YAML) |
| `Failed to load configuration file: {path}` | Config loading | File read error | Check file permissions and format |
| `Failed to build optimizer configuration` | Config building | Configuration build failure | Validate configuration syntax and structure |
| `Invalid integer value for property {key}: {value}` | Config parsing | Type conversion error | Provide valid integer values |
| `Invalid long value for property {key}: {value}` | Config parsing | Type conversion error | Provide valid long values |
| `Invalid double value for property {key}: {value}` | Config parsing | Type conversion error | Provide valid double values |
| `Invalid enum value for property {key}: {value}. Valid values are: {validValues}` | Config parsing | Invalid enum value | Use valid enumeration values |

### Optimizer Operation Errors

| Error Message | Context | Cause | Troubleshooting |
|---------------|---------|-------|----------------|
| `Configuration must not be null` | Factory methods | Null configuration | Provide valid configuration object |
| `QueryBuilder must not be null` | Optimizer operations | Null query builder | Initialize query builder before optimization |
| `Predicates list must not be null` | Predicate optimization | Null predicates list | Initialize predicates list |
| `Predicate must not be null` | Predicate processing | Null individual predicate | Ensure all predicates are initialized |
| `Join graph must not be null` | Join optimization | Null join graph | Provide valid join graph structure |
| `Available indexes list must not be null` | Index optimization | Null indexes list | Initialize available indexes list |
| `Join sequence must not be null` | Join reordering | Null join sequence | Provide valid join sequence |

**Example Optimizer Usage:**
```java
// ✅ Correct optimizer usage
QueryOptimizer optimizer = QueryOptimizer.builder()
    .enablePredicatePushdown(true)
    .enableJoinReordering(true)
    .build();

List<Predicate> predicates = Arrays.asList(
    new SimplePredicate("status", "=", "active"),
    new SimplePredicate("age", ">", 18)
);

OptimizationResult result = optimizer.optimize(queryBuilder, predicates);

// ❌ Will throw "QueryBuilder must not be null"
optimizer.optimize(null, predicates);

// ❌ Will throw "Predicates list must not be null"
optimizer.optimize(queryBuilder, null);
```

---

## Maintenance Guidelines

### For Developers Adding New Error Messages

1. **Consistent Error Messages:**
   - Use descriptive, specific error messages
   - Include problematic values in the message when helpful
   - Follow the existing message format patterns

2. **Exception Types:**
   - Use `QueryBuildException` for construction/validation errors
   - Use `QueryExecutionException` for runtime/database errors  
   - Use `OptimizationException` for optimization-specific errors
   - Use `DynamicQueryException` for general library errors

3. **Message Format Guidelines:**
   ```java
   // ✅ Good error message format
   throw new QueryBuildException("Field name must not be empty");
   
   // ✅ Include context when helpful
   throw new QueryBuildException("Invalid operator: '" + operator + 
       "'. Allowed operators are: " + ALLOWED_OPERATORS);
   
   // ❌ Avoid vague messages
   throw new QueryBuildException("Invalid input");
   ```

4. **Update Documentation:**
   - Add new error messages to this document
   - Include the context where the error occurs
   - Provide troubleshooting guidance
   - Add example code snippets when appropriate

### Documentation Update Process

1. **When Adding New Errors:**
   - Update the appropriate section in this document
   - Follow the existing table format
   - Include example code snippets for complex cases
   - Test the error conditions to verify accuracy

2. **When Modifying Existing Errors:**
   - Update both the code and this documentation
   - Ensure backward compatibility when possible
   - Update examples if the change affects usage

3. **Validation Checklist:**
   - [ ] All documented messages exist in the codebase
   - [ ] Error message format is consistent
   - [ ] Troubleshooting steps are helpful and actionable
   - [ ] Examples demonstrate both correct and incorrect usage
   - [ ] Documentation is updated as part of the same PR

### Error Message Best Practices

1. **Be Specific:** Include the actual problematic value when safe to do so
2. **Be Actionable:** Tell the developer what they need to do to fix the issue
3. **Be Consistent:** Use similar phrasing and format for related errors
4. **Be Safe:** Don't include sensitive information in error messages
5. **Chain Causes:** When catching and re-throwing, preserve the original cause

**Example Implementation:**
```java
public static void validateFieldName(String fieldName) {
    if (fieldName == null) {
        throw new QueryBuildException("Field name must not be null");
    }
    
    String trimmed = fieldName.trim();
    if (trimmed.isEmpty()) {
        throw new QueryBuildException("Field name must not be empty");
    }
    
    if (!FIELD_PATTERN.matcher(trimmed).matches()) {
        throw new QueryBuildException(
            "Field name contains invalid characters: '" + fieldName + 
            "'. Valid pattern is [A-Za-z0-9_\\.]+"
        );
    }
}
```

---

## Common Troubleshooting Workflows

### 1. Query Construction Issues
If you encounter errors during query building:

1. Check field name validity (alphanumeric + underscore + dot only)
2. Verify operator is in the supported whitelist  
3. Ensure all required parameters are non-null
4. Validate predicate construction logic

### 2. Cache-Related Issues
If you encounter cache errors:

1. Verify cache configuration parameters are positive
2. Check cache region names are non-empty
3. Ensure cache keys are valid strings
4. Monitor cache capacity and TTL settings

### 3. Optimizer Problems
If optimization fails:

1. Verify configuration file exists and is readable
2. Check configuration format and syntax
3. Ensure all optimizer inputs are non-null
4. Validate predicate and join graph structure

### 4. Configuration Errors
For configuration-related issues:

1. Verify all required configuration objects are provided
2. Check that numeric values are within acceptable ranges
3. Ensure configuration priorities are positive
4. Validate configuration file format and location

---

**Last Updated:** October 2025  
**Version:** 1.0.0  
**Maintainer:** Query4j Development Team

For additional support or to report issues with this documentation, please create an issue in the [Query4j repository](https://github.com/query4j/dynamicquerybuilder).